<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>BECI Interactive Map (DRAFT)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ArcGIS JS API -->
  <link rel="stylesheet" href="https://js.arcgis.com/4.30/esri/themes/light/main.css" />
  <script src="https://js.arcgis.com/4.30/"></script>

  <!-- Basic theming for the POC. Feel free to move this to a separate CSS file. -->
  <style>
    :root { --bg:#f7f7fb; --ink:#1b1b1f; --muted:#6b7280; --brand:#0ea5e9; --panel:#ffffff; --border:#e5e7eb; }
    html, body { height:100%; margin:0; }
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; background:var(--bg); color:var(--ink); }
    .topbar { display:flex; align-items:center; gap:.75rem; padding:.5rem .75rem; border-bottom:1px solid var(--border); background:var(--panel); position:sticky; top:0; z-index:10; }
    .tablist { display:flex; gap:.25rem; }
    .tab { border:1px solid var(--border); background:#fff; padding:.35rem .6rem; border-radius:.6rem; cursor:pointer; }
    .tab.is-active { border-color:var(--brand); color:#0b5e86; background:#f0f9ff; }
    /* Sub-tab styling: reuse the base tab styling but reduce font size and padding so the
       subcategory controls fit comfortably within the side panel.  Sub-tabs do not share
       the .tab class so they are excluded from top-level tab logic. */
    .subtab {
      border: 1px solid var(--border);
      background: #fff;
      padding: .25rem .45rem;
      border-radius: .6rem;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .subtab.is-active {
      border-color: var(--brand);
      color: #0b5e86;
      background: #f0f9ff;
    }
    .layout { display:grid; grid-template-columns: 340px 1fr; gap:.75rem; height: calc(100% - 56px); padding:.75rem; }
    .side { background:var(--panel); border:1px solid var(--border); border-radius:.8rem; padding:.75rem; overflow:auto; }
    .mapwrap { position:relative; background:#dbeafe; border:1px solid var(--border); border-radius:.8rem; overflow:hidden; }
    #viewDiv { position:absolute; inset:0; }
    .section { margin-bottom:1rem; }
    .section h3 { margin:.25rem 0 .5rem; font-size:1rem; }
    .muted { color:var(--muted); font-size:.9rem; }
    fieldset { border:1px solid var(--border); border-radius:.6rem; padding:.5rem .6rem; }
    legend { padding:0 .25rem; color:var(--muted); }
    .row { display:flex; gap:.5rem; align-items:center; flex-wrap:wrap; }
    /* Hide legacy time bar; the app will use a built-in TimeSlider. */
    .timebar { display:none; }
  </style>
</head>
<body>
  <header class="topbar">
    <!-- Update the header to reflect the broader Knowledge Network focus. -->
    <strong>BECI Knowledge Network (Draft)</strong>
    <div class="tablist" id="tablist">
      <!-- Rename the tabs to align with the language guide: Home and Environmental conditions. -->
      <!-- Updated tab labels to reflect the language guidance. -->
      <button class="tab is-active" data-theme="intro">Introduction</button>
      <!-- The Ocean state tab has been renamed to Environmental conditions to reflect the broader scope of this theme. -->
      <button class="tab" data-theme="env">Environmental&nbsp;conditions</button>
      <button class="tab" data-theme="pressures">Ecosystem&nbsp;status</button>
      <button class="tab" data-theme="jurisdictions">Management&nbsp;&amp;&nbsp;Ecosystem&nbsp;Boundaries</button>
      <button class="tab" data-theme="fish">Fish dynamics&nbsp;&amp;&nbsp;impacts</button>
    </div>
  </header>

  <main class="layout">
    <aside class="side">
      <div id="themeTitle" class="section">
        <h2>Welcome</h2>
        <!-- The tagline below the heading is intentionally left blank.  Each theme will provide its own description in the content area. -->
      </div>

      <!-- Sub-tab list for the Environmental conditions theme.  This list is hidden by default and
           only becomes visible when the Environmental conditions tab is selected.  Each button
           represents a subcategory (Ocean State or Extreme Events) and controls which dataset
           controls and description appear below. -->
      <div id="envSubTabList" class="section" style="display:none">
        <div class="tablist">
          <!-- Use the existing tab styling for sub-tabs but apply the .subtab class to allow
               custom sizing via CSS.  The non‑breaking spaces ensure consistent spacing. -->
          <!-- Do not apply the .tab class to sub-tabs so that top-level tab logic does not treat them as primary tabs. -->
          <button class="subtab is-active" data-sub="ocean">Ocean&nbsp;State</button>
          <button class="subtab" data-sub="extreme">Extreme&nbsp;Events</button>
        </div>
      </div>

      <div id="themeContent" class="section">
        <p>This proof-of-concept shows one interactive map with multiple thematic tabs. Pick a raster below, then scrub time.</p>
        <ul class="muted">
          <li>One time-aware raster visible at a time (clean TimeSlider binding).</li>
          <li>Species/admin layers appear on relevant tabs.</li>
        </ul>
      </div>

      <div id="layerPanel" class="section">
        <fieldset>
          <legend>Raster layers (exclusive)</legend>
          <div class="row">
            <!-- Include physical units in the raster labels so users know what each measurement represents. -->
            <label><input type="radio" name="rasterChoice" value="sstMonthly" checked> SST (Monthly, °C)</label>
            <label><input type="radio" name="rasterChoice" value="sstAnnual"> SST (Annual, °C)</label>
            <label><input type="radio" name="rasterChoice" value="chlMonthly"> Chlorophyll (Monthly, mg/m³)</label>
            <!-- Added option for annual chlorophyll.  Using a separate value allows the app logic
                 to toggle this layer independently of the monthly chlorophyll. Include units (mg/m³). -->
            <label><input type="radio" name="rasterChoice" value="chlAnnual"> Chlorophyll (Annual, mg/m³)</label>
          </div>
          <!-- Note: the guidance about displaying a single dataset at a time has been
               incorporated into the Ocean state description.  We remove the
               redundant tip here to declutter the panel. -->
        </fieldset>
      </div>

      <div id="vectorPanel" class="section">
        <fieldset>
          <legend>Species overlays</legend>
          <div class="row">
            <!-- Allow users to toggle Large Marine Ecosystem boundaries on and off.  The species shift
                 controls have been removed per the latest check-in notes to simplify the panel. -->
            <label><input type="checkbox" id="chkLMEs" checked> LMEs</label>
          </div>
        </fieldset>
      </div>

      <!-- Extreme events panel: toggles for heatwave overlays -->
      <div id="pressuresPanel" class="section" style="display:none">
        <fieldset>
          <legend>Extreme events</legend>
          <div class="row">
            <label><input type="checkbox" id="chkMHW" checked> Marine heatwave events</label>
          </div>
        </fieldset>
      </div>
      <!-- Jurisdictions panel: toggles for governance and ecosystem boundaries -->
      <div id="jurisPanel" class="section" style="display:none">
        <fieldset>
          <legend>Management &amp; ecosystem boundaries</legend>
          <!-- EEZ boundaries -->
          <div class="row">
            <strong>EEZ boundaries</strong>
          </div>
          <div class="row" style="margin-bottom:.25rem">
            <label><input type="checkbox" id="chkEEZ" checked> EEZ boundaries</label>
          </div>
          <!-- LME boundaries -->
          <div class="row">
            <strong>Large Marine Ecosystems (LMEs)</strong>
          </div>
          <div class="row" style="margin-bottom:.25rem">
            <label><input type="checkbox" id="chkJurLMEs" checked> LMEs</label>
          </div>
          <!-- RFMO convention areas -->
          <div class="row">
            <strong>Regional Fisheries Management Organisations</strong>
          </div>
          <div class="row" style="flex-direction:column; gap:.5rem">
            <label for="rfmoSelect">RFMO boundaries (multi‑select):</label>
            <select id="rfmoSelect" multiple size="6" style="width:100%">
              <option value="NPFC">North Pacific Fisheries Commission (NPFC)</option>
              <option value="NPAFC">North Pacific Anadromous Fish Commission (NPAFC)</option>
              <option value="PSC">Pacific Salmon Commission (PSC)</option>
              <option value="IPHC">International Pacific Halibut Commission (IPHC)</option>
              <option value="WCPFC">Western &amp; Central Pacific Fisheries Commission (WCPFC)</option>
              <option value="IATTC">Inter-American Tropical Tuna Commission (IATTC)</option>
            </select>
            <div style="display:flex; gap:.5rem">
              <button type="button" id="rfmoAll"  class="btn">All</button>
              <button type="button" id="rfmoNone" class="btn">None</button>
            </div>
            <small>Tip: use Shift/Ctrl (Cmd on Mac) to pick several.</small>
          </div>

          <!-- Species filter for RFMO convention areas -->
          <div class="row">
            <strong>Filter RFMOs by species</strong>
          </div>
          <div class="row" style="flex-direction:column; gap:.5rem">
            <label for="rfmoSpeciesSelect">Species (multi-select):</label>
            <select id="rfmoSpeciesSelect" multiple size="6" style="width:100%">
              <!-- Options will be populated dynamically by the app -->
            </select>
            <!-- Clear species selection button -->
            <div style="display:flex; gap:.5rem; margin-top:.3rem">
              <button type="button" id="rfmoSpeciesClear" class="btn">Clear</button>
            </div>
          </div>

          <!-- Member filter for RFMO convention areas -->
          <div class="row">
            <strong>Filter RFMOs by member nations / parties</strong>
          </div>
          <div class="row" style="flex-direction:column; gap:.5rem">
            <label for="rfmoMemberSelect">Member nations / parties (multi-select):</label>
            <select id="rfmoMemberSelect" multiple size="6" style="width:100%">
              <!-- Options will be populated dynamically by the app -->
            </select>
            <!-- Clear member selection button -->
            <div style="display:flex; gap:.5rem; margin-top:.3rem">
              <button type="button" id="rfmoMemberClear" class="btn">Clear</button>
            </div>
          </div>
          <!-- Optional placeholder for dashed special zones -->
          <div class="row" style="margin-top:.5rem">
            <strong>Special management zones</strong>
          </div>
          <div class="row">
            <label><input type="checkbox" id="chkSpecial" disabled> (coming soon)</label>
          </div>
        </fieldset>
      </div>


      <!-- Fish panel: toggles for fish stock and ecosystem impact overlays -->
      <div id="fishPanel" class="section" style="display:none">
        <fieldset>
          <legend>Fish overlays</legend>
          <div class="row">
            <label><input type="checkbox" id="chkStock" checked> Stock status</label>
            <label><input type="checkbox" id="chkImpact" checked> Ecosystem impacts</label>
          </div>
        </fieldset>
      </div>

      <!-- Legend will be injected here by the application -->
      <fieldset><div id="legendDiv" class="section"></div></fieldset>
    </aside>

    <section class="mapwrap">
      <div id="viewDiv"></div>
      <!-- Legacy time bar kept for backward compatibility; hidden by CSS and app logic -->
      <div class="timebar" id="timeBar">
        <button class="btn" id="btnPlay" title="Play/Pause">▶</button>
        <span id="timeLabel" class="pill">–</span>
        <div id="timeSlider"></div>
      </div>
    </section>
  </main>

  <!-- Load the local configuration from the project root.  This provides the API key, spatial reference and item IDs. -->
  <script src="./config.local.js"></script>
  <!-- Application logic -->
  <!-- Load the local application logic.  The script is located at the project root rather than within a js/ subfolder. -->
  <script src="./js/app.js"></script>
</body>
</html>
